<!DOCTYPE html>
<html>
{% include head.html %}

<body>
	{% include header.html %}

	<div id="main" class="alt">
		<section id="one">
			<div class="inner">
				<!-- Title -->
				<header class="major">
					<h1>{{ page.description }}</h1>
				</header>
				<!-- Map -->
				<div class="map-container">
					<div id="map">

					</div>
				</div>
				<!-- Gallery -->
				<div class="flightgallery">
					<div class="box alt">
						<div class="row 50% uniform">
							{% capture preview_folder %}/assets/images/screenshots/{{ page.legNo }}/tn{% endcapture %}
							{% capture image_folder %}/assets/images/screenshots/{{ page.legNo }}{% endcapture %}
							{% for file in site.static_files %}
							{% if file.path contains preview_folder %}
							{% assign filenameparts = file.path | split: "/" %}
							{% assign filename = filenameparts | last | replace: file.extname,"" %}
							{% assign filebits = filename | split: "-" %}
							{% assign departure = filebits[0] %}
							{% assign arrival = filebits[1] %}
							{% assign type = filebits[2] %}
							{% assign number = filebits[3] %}
							{% assign caption = departure | append: "-" | append: arrival | append: "-Screenshot-" | append: number %}
							{% assign preview = image_folder | append: "/tn/" | append: departure | append: "-" | append: arrival | append: "-Preview-" | append: number | append: ".jpg" %}
							{% assign image = image_folder | append: "/" | append: departure | append: "-" | append: arrival | append: "-Screenshot-" | append: number | append: ".jpg" %}
							<div class="3u 4u(medium) 6u(small)">
								<a class="fancy-image" data-src="{{ image }}" data-fancybox="gallery" data-caption="{{ caption }}">
									<img src="{{ preview }}" />
								</a>
							</div>
							{% endif %}
							{% endfor %}
						</div>
					</div>
				</div>
			</div>
		</section>
	</div>

	{% include footer.html %}

	<script defer>
		var map = L.map('map').setView([20, 0], 3);
		var flight = "{{page.departureIcao}}{{page.arrivalIcao}}";

		// Tiles
		L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
			attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
		}).addTo(map);

		$.getJSON("/assets/api/flights/" + flight + "-gps.json", function (data) {
			// Events
			$.each(data.e, function (key, val) {
				L.circleMarker(val.latlon, {
					radius: 5,
					color: "Orange",
				}).addTo(map).bindPopup(val.name);
			});

			// Screenshots
			$.each(data.img, function (key, val) {
				L.circleMarker(val.latlon, {
					radius: 5,
					color: "Violet",
				}).addTo(map).bindPopup('<a data-src="' + val.uri + '" data-fancybox="gallery" data-caption="' + val.name + '">' + val.name + '</a>');
			});

			// Waypoints
			$.each(data.wp, function (key, val) {
				L.circleMarker(val.latlon, {
					radius: 5,
					color: "MediumSeaGreen",
				}).addTo(map).bindPopup(val.name);
			});

			// Track
			var polyline = L.polyline(data.trk, { color: 'DodgerBlue' }).addTo(map);
			map.fitBounds(polyline.getBounds());
		});
	</script>

</body>

</html>